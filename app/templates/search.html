<html lang="en">

<head>
    <link rel="stylesheet" href="/static/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/main.css" />
    <title>Curator: Museum Finder</title>
</head>

<body>
    <main>
        <form class="form-inline global-search">
            <h1>Curator</h1>
            <p>Find the museum for you.</p>

            <div class="form-group">
                <input aria-label="Search" id="input" type="text" name="search" class="form-control"
                    value="{{ search_terms }}" placeholder="Search for museums" />
                <input aria-label="Location (if preferred)" id="input-loc" type="text" name="location"
                    class="form-control" value="" placeholder="Location as (Latitude, Longitude) (optional)" />
                <button type="submit" class="btn btn-info">Go!</button>
            </div>
        </form>

        <div class="search-output global-search">
            {% if data %}
            <h2 class="output-message">{{ output_message }}</h2>
            {% for d in data %}
            <div class="output-museum">
                <h3 class="output-museum-name">{{ d }}</h3>
                <p class="output-museum-desc">{{ data[d] }}</p>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </main>
    <!-- Code taken from: https://developers.google.com/maps/documentation/javascript/examples/event-click-latlng#all
          with some modifications-->
    <!-- Not sure about the map placement after the search is done; also location not part of algorithm yet, so clicking on map doesn't affect search results -->

    <style type="text/css">
        /* Always set the map height explicitly to define the size of the div
 * element that contains the map. */
        #map {
            height: 50%;
            width: 50%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script>
        // These variables indicate the clicked longitude and latitude, maybe these are necessary when we pass them to algo?
        var curr_long = 0;
        var curr_lat = 0;

        function initMap() {
            const myLatlng = { lat: 38.368474229577934, lng: -99.11682335273923 };
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 4,
                center: myLatlng,
            });
            // Create the initial InfoWindow.
            let infoWindow = new google.maps.InfoWindow({
                content: "Click the map to get Latitude and Longitude!",
                position: myLatlng,
            });
            infoWindow.open(map);
            // const geocoder = new google.maps.Geocoder(); subscription required :/
            // Configure the click listener.
            map.addListener("click", (mapsMouseEvent) => {
                // Close the current InfoWindow.
                infoWindow.close();
                // Create a new InfoWindow.
                infoWindow = new google.maps.InfoWindow({
                    position: mapsMouseEvent.latLng,
                });

                curr_long = mapsMouseEvent.latLng.toJSON().lng.toFixed(2);
                curr_lat = mapsMouseEvent.latLng.toJSON().lat.toFixed(2);
                formatted_long_lat = "(" + curr_long + ", " + curr_lat + ")"
                document.getElementById("input-loc").value = formatted_long_lat;
                infoWindow.setContent(
                    "longitude: " + curr_long + " latitude: " + curr_lat
                );
                infoWindow.open(map);
            });

        }
        console.log(curr_long);
    </script>

    <div id="map"></div>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1Bq3RwUmv7r8VG-3p1OWQVGMypRfTv1I&callback=initMap&libraries=&v=weekly"
        async></script>
    <!-- End of Map Code -->

    <footer>
        <p>Project Name: {{ name }}</p>
        <p>Student Names: {{ netid }}</p>
    </footer>
</body>

</html>
